\documentclass[<< settings.font_size_in_point >>pt]{article}

\usepackage{xkeyval}
\usepackage{microtype}
\usepackage{enumitem}
\usepackage{fontspec}
\usepackage[skip=.1\baselineskip plus 0pt]{parskip}
\usepackage[top=<< settings.top_margin_in_inch >>in, bottom=<< settings.bottom_margin_in_inch >>in, left=<< settings.left_margin_in_inch >>in, right=<< settings.right_margin_in_inch >>in]{geometry}

\raggedbottom

\setmainfont{<< settings.main_font >>}<! if settings.old_style_numbers !>[Numbers={OldStyle, Proportional}]<! endif !>

\makeatletter
\define@key{activitykeys}{role}{\def\activity@role{#1}}
\define@key{activitykeys}{org}{\def\activity@org{#1}}
\define@key{activitykeys}{startdate}{\def\activity@startdate{#1}}
\define@key{activitykeys}{enddate}{\def\activity@enddate{#1}}
\define@key{activitykeys}{hoursperweek}{\def\activity@hoursperweek{#1}}
\define@key{activitykeys}{weeksperyear}{\def\activity@weeksperyear{#1}}
\newenvironment{activity}[1]{%
    \begingroup
    \setkeys{activitykeys}{org=, startdate=, enddate=, hoursperweek=, weeksperyear=, #1}%
    \textbf{\activity@role\ifx\activity@org\empty\else{, \activity@org}\fi}\par
    \activity@startdate\,--\,\activity@enddate
    \hfill
    \activity@hoursperweek\ hours/week, \activity@weeksperyear\ weeks/year\par
    \endgroup
    \begin{itemize}[nosep]
}{%
    \end{itemize}\par\addvspace{\medskipamount}
}
\makeatother

\begin{document}

<! if cv.name -!>
\begin{center}
	\LARGE\bfseries
	<< cv.name >>
\end{center}
<!- endif !>

<! if cv.email or cv.phone or cv.address or cv.website -!>
<! set bio = ' | '.join([cv.email, cv.phone, cv.address, cv.website]) -!>
\begin{center}
    << bio|replace('  |', '')|trim('| ') >>
\end{center}
<!- endif !>

<! for section in cv.activity_sections !>
\section*{<< section >>}

<! for activity in cv.activities_of_section(section) !>
\begin{activity}{%
    role={<< activity.role >>},
    org={<< activity.org >>},
    startdate={<< activity.start_date >>},
    enddate={<< activity.end_date >>},
    hoursperweek={<< activity.hours_per_week >>},
    weeksperyear={<< activity.weeks_per_year >>}
}
<! for descr in activity.descriptions -!>
    \item << descr >>
<! endfor -!>
\end{activity}
<! endfor !>
<! endfor !>
\end{document}
